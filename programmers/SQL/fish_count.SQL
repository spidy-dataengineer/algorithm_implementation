-- 코드를 작성해주세요
SELECT B.FISH_COUNT,
       B.MAX_LENGTH,
       B.FISH_TYPE
FROM (
    SELECT A.FISH_TYPE,
           COUNT(A.FISH_TYPE) AS FISH_COUNT,
           AVG(A.LENGTH) AS AVG_LENGTH,
           MAX(A.MAX_LENGTH) AS MAX_LENGTH
    FROM (
        SELECT FISH_TYPE,
                CASE WHEN LENGTH IS NULL THEN 10
                     ELSE LENGTH END AS LENGTH,
               MAX(LENGTH) OVER(PARTITION BY FISH_TYPE ORDER BY LENGTH DESC) AS MAX_LENGTH
        FROM FISH_INFO
        ) A
    GROUP BY A.FISH_TYPE
    ) B
WHERE B.AVG_LENGTH >= 33

-- 아래 처럼 단축 가능
SELECT COUNT(A.FISH_TYPE) AS FISH_COUNT,
       MAX(A.MAX_LENGTH) AS MAX_LENGTH,
       A.FISH_TYPE
FROM (
        SELECT FISH_TYPE,
                CASE WHEN LENGTH IS NULL THEN 10
                     ELSE LENGTH END AS LENGTH,
               MAX(LENGTH) OVER(PARTITION BY FISH_TYPE ORDER BY LENGTH DESC) AS MAX_LENGTH
        FROM FISH_INFO
        ) A
GROUP BY A.FISH_TYPE
HAVING AVG(A.LENGTH) >= 33

-- 더 줄일 수 있을 것 같음
